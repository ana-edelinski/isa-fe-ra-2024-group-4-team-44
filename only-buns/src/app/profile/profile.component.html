<div class="user-card">
  <!-- HEADER sa COVER i SETTINGS dugmetom -->
  <div class="user-card-header">
    <img src="assets/background.jpg" alt="Background" class="background" />

    <!-- SETTINGS BUTTON gore desno na coveru -->
    <button mat-icon-button class="settings-button" (click)="toggleSettings()">
      <mat-icon>{{ showSettings ? 'close' : 'settings' }}</mat-icon>
    </button>
  </div>

  <!-- USER INFO -->
  <div class="user-info">
    <img [src]="user.avatar || 'assets/default-avatar.jpg'" alt="{{ user.name }}" class="avatar" />
    <div class="name-container">
      <h2 class="user-name">{{ user.name }} {{ user.surname }}</h2>
      <span class="username">{{ '@' + user.username }}</span>
    </div>
    <p class="email">üìß {{ user.email }}</p>

    <div *ngIf="user.street || user.city || user.postalCode" class="address">
      <p>üè† {{ user.street }}, {{ user.city }}{{ user.postalCode ? ', ' + user.postalCode : '' }}</p>
    </div>

    <!-- FOLLOW/UNFOLLOW -->
    <div *ngIf="authService.isAuthenticated()" class="follow-info">
      <p>
        <span (click)="showModal('following')" class="clickable-text">
          Following: <strong>{{ followingCount }}</strong>
        </span>
      </p>
      <p>
        <span (click)="showModal('followers')" class="clickable-text">
          Followers: <strong>{{ followersCount }}</strong>
        </span>
      </p>
    </div>
  </div>

  <hr class="divider" />

  <!-- MODAL za FOLLOWERS / FOLLOWING -->
  <div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ modalTitle }}</h2>
        <button class="close-button" (click)="closeModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div *ngIf="modalUsers.length === 0">
          <p *ngIf="modalTitle === 'Following'">No following</p>
          <p *ngIf="modalTitle === 'Followers'">No followers</p>
        </div>
        <div *ngFor="let user of modalUsers" class="user-row">
          <img [src]="user.avatar || 'assets/default-avatar.jpg'" alt="Avatar" class="user-avatar">
          <div class="user-info">
                <p class="username" (click)="navigateToProfile(user.id)">{{ user.username }}</p>
            <p class="name">{{ user.name }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AKO JE SETTINGS U MODU, prikazi forme -->
  <div *ngIf="showSettings" class="form-container">
    <!-- User Profile Form -->
    <mat-card class="profile-card">
      <h3>User Profile</h3>
      <div class="profile-info">
        <mat-form-field appearance="fill">
          <mat-label>First Name</mat-label>
          <input matInput [(ngModel)]="user.name" required />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Last Name</mat-label>
          <input matInput [(ngModel)]="user.surname" required />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="user.email" disabled />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Street</mat-label>
          <input matInput [(ngModel)]="user.street" />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>City</mat-label>
          <input matInput [(ngModel)]="user.city" />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Postal Code</mat-label>
          <input matInput [(ngModel)]="user.postalCode" />
        </mat-form-field>
                <mat-form-field appearance="fill">
        <mat-label>Longitude</mat-label>
          <input matInput [(ngModel)]="user.longitude" />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Latitude</mat-label>
          <input matInput [(ngModel)]="user.latitude" />
        </mat-form-field>
        <button mat-raised-button class="follow-button" (click)="updateProfile()">Update Profile</button>
      </div>
    </mat-card>

    <!-- Change Password Form -->
    <mat-card class="password-card">
      <h3>Change Password</h3>
      <form (ngSubmit)="changePassword()">
        <mat-form-field appearance="fill">
          <mat-label>Old Password</mat-label>
          <input matInput type="password" [(ngModel)]="oldPassword" name="oldPassword" required />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>New Password</mat-label>
          <input matInput type="password" [(ngModel)]="newPassword" name="newPassword" required />
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Confirm New Password</mat-label>
          <input matInput type="password" [(ngModel)]="confirmPassword" name="confirmPassword" required />
        </mat-form-field>
        <button mat-raised-button type="submit" class="follow-button">Change Password</button>
      </form>
    </mat-card>
  </div>

  <!-- INACE PRIKAZI MOJE POSTOVE -->
  <div *ngIf="!showSettings">
    <app-my-posts></app-my-posts>
  </div>

</div>
